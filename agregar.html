<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <title>Ventas</title>
</head>
<body>
    <nav class="navbar navbar-expand-lg bg-primary">
        <div class="container">        
          <a class="navbar-brand fs-5 fw-bold text-white" href="#">Ventas</a>
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link fs-6 fw-bold text-white" href="index.html">lista</a>
            </li>
            <li class="nav-item">
              <a class="nav-link fs-6 fw-bold text-white" href="agregar.html">agregar</a>
            </li>
          </ul>
        </div>
      </nav>
      <div class="container mt-3">
        <div class="alert alert-danger invisible" id="errores">
            <p></p>
        </div>
        </div>
    <div class="container mt-3">
        <form action="">
            <div class="mb-3">
                <label for="cliente" class="form-label">Cliente</label>
                <input type="text" class="form-control" id="cliente" name="cliente">
            </div>
            <div class="mb-3 mt-3">
                <label for="vendedor" class="form-label">Vendedor</label>
                <input type="text" class="form-control" id="vendedor" name="vendedor">
            </div>
            <div class="mb-3">
                <label for="fecha_instalacion" class="form-label">Fecha Instalaci√≥n</label>
                <input type="date" class="form-control" id="fecha_instalacion" name="fecha_instalacion">
            </div>
            <div class="mb-3">
                <label for="estado" class="form-label">Estado</label>
                <select id="estado" name="estado" class="form-control">
                    <option value="instalada">Instalada</option>
                    <option value="pendiente">Pendiente</option>
                </select>
            </div>
            <div class="row mb-3 mt-5">
                <div class="col-2">
                    <button type="button" class="w-100 btn btn-primary fw-bold" onclick="agregar_venta()">Agregar Venta</button>
                </div>
                <div class="col-2">
                    <button type="button" class="w-100 btn btn-primary fw-bold" onclick="window.location.href = 'index.html'">Volver a la lista</button>                
                </div>
            </div>
            </form>   
    </div>
<script>
    function agregar_venta(){        
        var venta = {
                cliente: document.getElementById('cliente').value,
                vendedor: document.getElementById('vendedor').value,
                fechaInstalacion: document.getElementById('fecha_instalacion').value,
                estado: document.getElementById('estado').value
            }
        
        let dato = JSON.stringify(venta)        

        fetch("http://127.0.0.1:3000/api/ventas/", { 
            method: 'POST',
            body: dato,
            credentials: 'same-origin',
            headers: { 'Accept': 'application/json, text/plain, */*',
                'Content-Type': 'application/json', 
                }
        }).then( (res) => {
            if (res.ok) {
                return res.json().then(
                    (datos) => {            
                        console.log(datos)   
                        window.location.href = 'index.html'                              
                    }
                )
            } else if (res.status === 400) {    
                return res.json().then(
                    (datos) => {            
                        console.log(datos)                           
                        let e = document.getElementById('errores')
                        e.innerHTML = JSON.stringify(datos.message)
                        e.classList.remove('invisible')
                    }
                )
            } else {
                return res.json().then(
                    (datos) => {            
                        console.log(datos)                           
                        let e = document.getElementById('errores')
                        e.innerHTML = 'se produjo un error al intentar agregar una nueva venta'
                        e.classList.remove('invisible')
                    }
                )
            } 

            //return res.json();            

        }).catch((error) => {
            console.log('error' + error)
            let e = document.getElementById('errores')
            e.innerHTML = 'se produjo un error al intentar agregar una nueva venta'
            e.classList.remove('invisible')
        })                   
    }    
</script>
</body>
</html>
